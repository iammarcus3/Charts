<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Number One Songs - Hot 100, Streams & Radio</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    margin: 2rem;
  }
  h1 {
    text-align: center;
    margin-bottom: 2rem;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    max-width: 1000px;
    margin: 0 auto;
  }
  .card {
    background: #222;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: 0 0 8px #000;
  }
  .card h2 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-size: 1.3rem;
    border-bottom: 1px solid #444;
    padding-bottom: 0.3rem;
  }
  .song-title {
    font-weight: bold;
    font-size: 1.1rem;
    cursor: pointer;
    color: #1db954;
  }
  .artist-name {
    font-style: italic;
    cursor: pointer;
    color: #ccc;
  }
  .cert {
    display: inline-block;
    margin-left: 0.5rem;
    font-weight: bold;
    color: gold;
  }
  .details {
    margin-top: 0.8rem;
    font-size: 0.9rem;
    color: #bbb;
  }
</style>
</head>
<body>
<h1>Number One Songs</h1>
<div class="grid" id="numberOneGrid">
  <div class="card" id="hot100Card">
    <h2>Hot 100 #1 Song (Sales)</h2>
    <div id="hot100Song"></div>
  </div>
  <div class="card" id="streamedCard">
    <h2>#1 Streamed Song (Last 7 Days)</h2>
    <div id="streamedSong"></div>
  </div>
  <div class="card" id="radioCard">
    <h2>#1 Radio Song (Radio Sales)</h2>
    <div id="radioSong"></div>
  </div>
</div>

<script src="weekdata.js"></script>
<script>
  // Your radio multiplier function
  function getMultiplier(weeks) {
    if (weeks <= 4) return 2890;
    if (weeks <= 10) return 8450;
    if (weeks <= 16) return 11040;
    if (weeks <= 20) return 8690;
    if (weeks <= 30) return 4540;
    if (weeks <= 40) return 3090;
    return 1010;
  }

  // Certification logic same as your usual logic
  function getCertification(sales) {
    if (sales >= 1_000_000) return 'ðŸ’Ž Diamond';
    if (sales >= 200_000) return 'ðŸ’¿ x2 Platinum';
    if (sales >= 100_000) return 'ðŸ’¿ Platinum';
    if (sales >= 50_000) return 'ðŸ¥‡ Gold';
    return '';
  }

  function createSongHTML(song) {
    const cert = getCertification(song.totalSales || song.sales);
    return `
      <div>
        <div class="song-title" title="Click for details" onclick="alert('Song: ${song.title}\\nArtist: ${song.artist}')">${song.title}</div>
        <div class="artist-name" title="Click for artist details" onclick="alert('Artist: ${song.artist}')">${song.artist}</div>
        ${cert ? `<div class="cert">${cert}</div>` : ''}
        <div class="details">
          ${song.sales !== undefined ? `Sales: ${song.sales.toLocaleString()}` : ''}
          ${song.plays !== undefined ? `Plays: ${song.plays.toLocaleString()}` : ''}
        </div>
      </div>
    `;
  }

  (function main() {
    const weekKeys = Object.keys(weekData).map(Number).sort((a,b) => a-b);
    const latestWeek = weekKeys[weekKeys.length - 1];
    const latestWeekData = weekData[latestWeek];

    // 1) Hot 100 #1 by sales (rank=1)
    let hot100NumberOne = null;
    for (const song of Object.values(latestWeekData)) {
      if (song.rank === 1) {
        hot100NumberOne = song;
        break;
      }
    }

    // 2) #1 streamed song aggregated over last 7 days
    const recentWeeks = weekKeys.filter(w => w > latestWeek - 7 && w <= latestWeek);
    const streamAgg = {};
    recentWeeks.forEach(week => {
      const data = weekData[week];
      Object.values(data).forEach(s => {
        const key = s.title.toLowerCase() + '|' + s.artist.toLowerCase();
        if (!streamAgg[key]) {
          streamAgg[key] = { title: s.title, artist: s.artist, plays: 0, sales: 0, totalSales: 0 };
        }
        streamAgg[key].plays += s.plays || 0;
        streamAgg[key].sales += s.sales || 0;
        streamAgg[key].totalSales += s.totalSales || 0;
      });
    });
    let topStreamedSong = null;
    for (const s of Object.values(streamAgg)) {
      if (!topStreamedSong || s.plays > topStreamedSong.plays) {
        topStreamedSong = s;
      }
    }

    // 3) #1 radio song: compute radio sales = sales * getMultiplier(weeks)
    let topRadioSong = null;
    for (const song of Object.values(latestWeekData)) {
      const radioSales = (song.sales || 0) * getMultiplier(song.weeks || 0);
      if (!topRadioSong || radioSales > topRadioSong.radioSales) {
        topRadioSong = {...song, radioSales};
      }
    }

    document.getElementById('hot100Song').innerHTML = hot100NumberOne ? createSongHTML(hot100NumberOne) : 'No data';
    document.getElementById('streamedSong').innerHTML = topStreamedSong ? createSongHTML(topStreamedSong) : 'No data';
    document.getElementById('radioSong').innerHTML = topRadioSong ? createSongHTML(topRadioSong) : 'No data';
  })();
</script>
</body>
</html>
