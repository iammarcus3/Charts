<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Top Radio Songs - Weekly</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      font-size: 2rem;
    }
    .controls {
      text-align: center;
      margin-bottom: 1rem;
    }
    .controls button {
      font-size: 1.2rem;
      margin: 0 1rem;
      background: #222;
      color: #fff;
      border: 1px solid #444;
      padding: 0.4rem 1rem;
      border-radius: 8px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #444;
      padding: 0.5rem;
      text-align: left;
    }
    th {
      background-color: #222;
    }
    tr:nth-child(even) {
      background-color: #1a1a1a;
    }
    .up { color: #00ff00; font-weight: bold; }
    .down { color: #ff4444; font-weight: bold; }
    .same { color: #aaa; }
    .bold { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Top 50 Radio Songs (Weekly)</h1>
  <div class="controls">
    <button id="prevWeek">‚¨ÖÔ∏è</button>
    <span id="weekLabel">Week </span>
    <button id="nextWeek">‚û°Ô∏è</button>
  </div>
  <table>
    <thead>
      <tr>
        <th>Rank</th>
        <th>Move</th>
        <th>Title</th>
        <th>Artist</th>
        <th>Sales</th>
        <th>Weeks Charted</th>
        <th>Audience Points</th>
      </tr>
    </thead>
    <tbody id="radioTable"></tbody>
  </table>

  <script src="weekdata.js"></script>
  <script>
    const table = document.getElementById('radioTable');
    const weekLabel = document.getElementById('weekLabel');
    const weekKeys = Object.keys(weekData).map(Number).sort((a, b) => b - a);
    const last26Weeks = weekKeys.slice(0, 26); // 6 months approx
    let currentWeekIndex = 0;

    function getMultiplier(weeks) {
      if (weeks <= 4) return 2890;
      if (weeks <= 10) return 6450;
      if (weeks <= 16) return 11040;
      if (weeks <= 20) return 7690;
      if (weeks <= 30) return 4540;
      if (weeks <= 40) return 3090;
      return 1010;
    }

    function countLifetimeWeeks(song) {
      let count = 0;
      for (let week of Object.keys(weekData)) {
        if (Number(week) > last26Weeks[currentWeekIndex]) continue;
        const matches = weekData[week].filter(entry =>
          entry.title.toLowerCase() === song.title.toLowerCase() &&
          entry.artist.toLowerCase() === song.artist.toLowerCase()
        );
        if (matches.length > 0) count++;
      }
      return count;
    }

    let previousRanks = {};

    function renderWeekChart() {
      const weekNum = last26Weeks[currentWeekIndex];
      const thisWeek = weekData[weekNum];
      weekLabel.textContent = `Week ${weekNum}`;

      const scored = thisWeek.map(song => {
        const lifetimeWeeks = countLifetimeWeeks(song);
        const multiplier = getMultiplier(lifetimeWeeks);
        const audience = song.sales * multiplier;
        return {
          title: song.title,
          artist: song.artist,
          sales: song.sales,
          weeks: lifetimeWeeks,
          audience,
        };
      });

      scored.sort((a, b) => b.audience - a.audience);
      const top50 = scored.slice(0, 50);
      const newRanks = {};

      table.innerHTML = top50.map((s, i) => {
        const prev = previousRanks[`${s.title}|${s.artist}`];
        const currRank = i + 1;
        newRanks[`${s.title}|${s.artist}`] = currRank;

        let movement = '<span class="same">‚ûñ</span>';
        if (prev) {
          if (currRank < prev) movement = '<span class="up">‚ñ≤</span>';
          else if (currRank > prev) movement = '<span class="down">üîª</span>';
        }

        const salesFormatted = s.sales.toLocaleString();
        const audienceFormatted = Math.min(s.audience, 100000000).toLocaleString();

        return `
          <tr>
            <td>${currRank}</td>
            <td>${movement}</td>
            <td class="${prev === undefined ? 'bold' : ''}">${s.title}</td>
            <td>${s.artist}</td>
            <td>${salesFormatted}</td>
            <td>${s.weeks}</td>
            <td>${audienceFormatted}</td>
          </tr>
        `;
      }).join("");

      previousRanks = newRanks;
    }

    document.getElementById('prevWeek').onclick = () => {
      if (currentWeekIndex < last26Weeks.length - 1) {
        currentWeekIndex++;
        renderWeekChart();
      }
    };

    document.getElementById('nextWeek').onclick = () => {
      if (currentWeekIndex > 0) {
        currentWeekIndex--;
        renderWeekChart();
      }
    };

    window.onload = () => {
      renderWeekChart();
    };
  </script>
</body>
</html>
