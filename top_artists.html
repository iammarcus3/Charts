<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Top Radio Songs</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 2rem;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    select, button {
      margin: 0.5rem;
      padding: 0.4rem 0.7rem;
      font-size: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      padding: 0.6rem;
      border-bottom: 1px solid #444;
      text-align: left;
    }
    th {
      background: #222;
    }
    .up { color: #0f0; }
    .down { color: #f33; }
    .same { color: #999; }
  </style>
</head>
<body>
  <h1>Top 50 Radio Songs (Last 6 Months)</h1>
  <div>
    <button onclick="changeWeek(-1)">‚¨ÖÔ∏è</button>
    <select id="weekSelector" onchange="renderTopRadioSongs()"></select>
    <button onclick="changeWeek(1)">‚û°Ô∏è</button>
  </div>
  <table>
    <thead>
      <tr>
        <th>Rank</th>
        <th>Movement</th>
        <th>Title</th>
        <th>Artist</th>
        <th>Sales</th>
        <th>Audience Points</th>
        <th>Total Weeks</th>
      </tr>
    </thead>
    <tbody id="radioTable"></tbody>
  </table>

  <script src="weekdata.js"></script>
  <script>
    const table = document.getElementById("radioTable");
    const selector = document.getElementById("weekSelector");
    let weeks = Object.keys(weekData).map(Number).filter(w => w >= 357); // last 6 months (if week 1 = 2018)
    weeks.sort((a, b) => b - a);
    let currentIndex = 0;

    // Build selector
    weeks.forEach(w => {
      const option = document.createElement("option");
      option.value = w;
      option.textContent = `Week ${w}`;
      selector.appendChild(option);
    });

    function getTotalWeeksCharted(title, artist, currentWeek) {
      let count = 0;
      for (let w = 1; w <= currentWeek; w++) {
        if (!weekData[w]) continue;
        if (weekData[w].some(song => song.title === title && song.artist === artist)) {
          count++;
        }
      }
      return count;
    }

    function getAudiencePoints(sales, weeks) {
      if (weeks <= 4) return sales * 2890;
      if (weeks <= 10) return sales * 5450;
      if (weeks <= 16) return sales * 11040;
      if (weeks <= 20) return sales * 7690;
      if (weeks <= 30) return sales * 4540;
      if (weeks <= 40) return sales * 3090;
      return sales * 1010;
    }

    let previousRanks = {};

    function renderTopRadioSongs() {
      const week = parseInt(selector.value);
      const songs = weekData[week] || [];
      const pointsMap = [];

      for (const song of songs) {
        const { title, artist, sales } = song;
        const totalWeeks = getTotalWeeksCharted(title, artist, week);
        const audiencePoints = getAudiencePoints(sales, totalWeeks);
        pointsMap.push({
          title,
          artist,
          sales,
          totalWeeks,
          audiencePoints,
        });
      }

      pointsMap.sort((a, b) => b.audiencePoints - a.audiencePoints);
      const top50 = pointsMap.slice(0, 50);

      table.innerHTML = "";
      top50.forEach((song, index) => {
        const prev = previousRanks[`${song.title}|||${song.artist}`];
        const currentRank = index + 1;
        let move = "‚ûñ", cls = "same";
        if (prev !== undefined) {
          if (prev > currentRank) { move = "‚ñ≤"; cls = "up"; }
          else if (prev < currentRank) { move = "üîª"; cls = "down"; }
        }
        previousRanks[`${song.title}|||${song.artist}`] = currentRank;

        const row = `
          <tr>
            <td>${currentRank}</td>
            <td class="${cls}">${move}</td>
            <td>${song.title}</td>
            <td>${song.artist}</td>
            <td>${song.sales.toLocaleString()}</td>
            <td>${Math.round(song.audiencePoints).toLocaleString()}</td>
            <td>${song.totalWeeks}</td>
          </tr>`;
        table.innerHTML += row;
      });
    }

    function changeWeek(offset) {
      currentIndex += offset;
      if (currentIndex < 0) currentIndex = 0;
      if (currentIndex >= weeks.length) currentIndex = weeks.length - 1;
      selector.value = weeks[currentIndex];
      renderTopRadioSongs();
    }

    window.onload = () => {
      selector.value = weeks[currentIndex];
      renderTopRadioSongs();
    };
  </script>
</body>
</html>
