<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Top Radio Songs</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    .nav {
      text-align: center;
      margin-bottom: 1rem;
    }
    .nav button {
      background: #444;
      color: #fff;
      border: none;
      padding: 0.5rem 1rem;
      margin: 0 1rem;
      font-size: 1rem;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #333;
    }
    th {
      background: #222;
    }
    .up { color: limegreen; }
    .down { color: red; }
    .new { color: gray; }
  </style>
</head>
<body>
  <h1>Top 50 Radio Songs (Weekly)</h1>
  <div class="nav">
    <button id="prevBtn">‚¨ÖÔ∏è</button>
    <span id="weekLabel">Week</span>
    <button id="nextBtn">‚û°Ô∏è</button>
  </div>
  <table>
    <thead>
      <tr>
        <th>Rank</th>
        <th>Move</th>
        <th>Title</th>
        <th>Artist</th>
        <th>Sales</th>
        <th>Weeks Charted</th>
        <th>Audience</th>
      </tr>
    </thead>
    <tbody id="chartBody"></tbody>
  </table>

  <script src="weekdata.js"></script>
  <script>
    const allWeeks = Object.keys(weekData).map(Number).sort((a, b) => a - b);
    const latestWeek = allWeeks[allWeeks.length - 1];
    const sixMonthsAgo = allWeeks.filter(w => w >= latestWeek - 26);
    let currentWeekIndex = sixMonthsAgo.length - 1; // start from most recent

    // Get total weeks charted for every (title + artist)
    const weeksChartedMap = {};
    for (const week of allWeeks) {
      for (const entry of weekData[week]) {
        const key = (entry.title + entry.artist).toLowerCase();
        weeksChartedMap[key] = (weeksChartedMap[key] || new Set()).add(week);
      }
    }

    function getWeeksCharted(key) {
      return weeksChartedMap[key] ? weeksChartedMap[key].size : 0;
    }

    function getMultiplier(weeks) {
      if (weeks <= 4) return 6890;
      if (weeks <= 10) return 9450;
      if (weeks <= 16) return 11040;
      if (weeks <= 20) return 7690;
      if (weeks <= 30) return 4540;
      if (weeks <= 40) return 3090;
      return 1010;
    }

    function renderChart() {
      const weekNum = sixMonthsAgo[currentWeekIndex];
      const entries = weekData[weekNum];
      const chartBody = document.getElementById("chartBody");
      document.getElementById("weekLabel").textContent = `Week ${weekNum}`;

      const prevWeekEntries = weekData[sixMonthsAgo[currentWeekIndex - 1] || -1] || [];
      const prevMap = {};
      for (const e of prevWeekEntries) {
        const key = (e.title + e.artist).toLowerCase();
        prevMap[key] = e.rank;
      }

      const ranked = entries.map(entry => {
        const key = (entry.title + entry.artist).toLowerCase();
        const weeksCharted = getWeeksCharted(key);
        const multiplier = getMultiplier(weeksCharted);
        const audience = entry.sales * multiplier;
        const prevRank = prevMap[key];
        let move = '‚ûñ', cls = 'new';
        if (prevRank) {
          const diff = prevRank - entry.rank;
          if (diff > 0) move = `<span class="up">‚ñ≤</span>`;
          else if (diff < 0) move = `<span class="down">üîª</span>`;
          else move = `<span class="new">‚ûñ</span>`;
        }
        return {
          ...entry,
          weeksCharted,
          audience,
          move
        };
      }).sort((a, b) => b.audience - a.audience).slice(0, 50);

      chartBody.innerHTML = ranked.map((entry, i) => `
        <tr>
          <td>${i + 1}</td>
          <td>${entry.move}</td>
          <td>${entry.title}</td>
          <td>${entry.artist}</td>
          <td>${entry.sales.toLocaleString()}</td>
          <td>${entry.weeksCharted}</td>
          <td>${Math.round(entry.audience).toLocaleString()}</td>
        </tr>
      `).join('');
    }

    document.getElementById("prevBtn").onclick = () => {
      if (currentWeekIndex > 0) {
        currentWeekIndex--;
        renderChart();
      }
    };

    document.getElementById("nextBtn").onclick = () => {
      if (currentWeekIndex < sixMonthsAgo.length - 1) {
        currentWeekIndex++;
        renderChart();
      }
    };

    window.onload = renderChart;
  </script>
</body>
</html>
