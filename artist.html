<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Artist Page</title>
  <link rel="stylesheet" href="billboard-style.css" />
  <style>
    table { width: 100%; border-collapse: collapse; margin-top: 2rem; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { cursor: pointer; background: #eee; }
    .highlight { font-weight: bold; color: #2c3e50; }
    ul { margin-top: 1rem; padding-left: 1.5rem; }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">üè† Hot 100</a>
    <a href="albums.html">üìÄ Albums</a>
    <a href="top_albums.html">üèÜ Top Albums</a>
  </nav>

  <h1 id="artistNameTitle">Artist Profile</h1>

  <section>
    <h2>üìä Artist Stats</h2>
    <p><strong>Total Songs Charted:</strong> <span id="songCount"></span></p>
    <p><strong>Number Ones:</strong> <span id="numOnes"></span></p>
    <p><strong>Debuts:</strong> <span id="debuts"></span></p>
    <p><strong>Total Albums Charted:</strong> <span id="albumCount"></span></p>
  </section>

  <section>
    <h2>üíø Albums</h2>
    <ul id="artistAlbums"></ul>
  </section>

  <section>
    <h2>üé∂ Songs</h2>
    <ul id="artistSongs"></ul>
  </section>

  <section>
    <h2>üìà Full Chart Table</h2>
    <table id="chartTable">
      <thead>
        <tr>
          <th onclick="sortTable(0)">Week</th>
          <th onclick="sortTable(1)">Title</th>
          <th onclick="sortTable(2)">Rank</th>
          <th onclick="sortTable(3)">Sales</th>
        </tr>
      </thead>
      <tbody id="chartBody"></tbody>
    </table>
  </section>

  <script src="albumdata.js"></script>
  <script src="weekdata.js"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const artistName = params.get("artist");
    const normArtist = artistName.toUpperCase().replace(/[^A-Z0-9 ]/g, "").trim();
    document.getElementById("artistNameTitle").textContent = artistName;

    function normalize(str) {
      return str.toUpperCase().replace(/[^A-Z0-9 ]/g, "").trim();
    }

    const albumsMap = {};
    const songsMap = {};
    let num1s = 0, debuts = 0, songCount = 0;
    const tableRows = [];

    for (const week in albumData) {
      albumData[week].forEach(row => {
        if (normalize(row.artist) === normArtist) {
          const key = normalize(row.album);
          if (!albumsMap[key]) {
            albumsMap[key] = {
              album: row.album,
              artist: row.artist,
              totalPlays: 0,
              weeks: 0,
              peak: row.rank,
              debutWeek: parseInt(week.replace(/\D/g,'')),
              num1s: 0
            };
          }
          albumsMap[key].weeks++;
          albumsMap[key].totalPlays += row.plays;
          if (row.rank === 1) albumsMap[key].num1s++;
          if (row.rank < albumsMap[key].peak) albumsMap[key].peak = row.rank;
        }
      });
    }

    for (const week in weekData) {
      weekData[week].forEach(row => {
        if (normalize(row.artist) === normArtist) {
          const key = normalize(row.title);
          if (!songsMap[key]) {
            songsMap[key] = {
              title: row.title,
              artist: row.artist,
              debut: parseInt(week.replace(/\D/g,'')),
              peak: row.rank,
              totalSales: 0,
              weeks: 0,
              num1: 0
            };
          }
          songsMap[key].weeks++;
          songsMap[key].totalSales += row.sales || 0;
          if (row.rank < songsMap[key].peak) songsMap[key].peak = row.rank;
          if (row.rank === 1) songsMap[key].num1 = 1;

          // For chart table
          tableRows.push([week, row.title, row.rank, row.sales || 0]);
        }
      });
    }

    songCount = Object.keys(songsMap).length;
    debuts = Object.values(songsMap).filter(s => s.weeks === 1).length;
    num1s = Object.values(songsMap).filter(s => s.num1 === 1).length;

    document.getElementById("songCount").textContent = songCount;
    document.getElementById("debuts").textContent = debuts;
    document.getElementById("numOnes").textContent = num1s;
    document.getElementById("albumCount").textContent = Object.keys(albumsMap).length;

    const albumsList = document.getElementById("artistAlbums");
    Object.values(albumsMap)
      .sort((a, b) => b.totalPlays - a.totalPlays)
      .forEach(album => {
        const li = document.createElement("li");
        const url = `album_detail.html?album=${encodeURIComponent(album.album)}&artist=${encodeURIComponent(album.artist)}`;
        li.innerHTML = `<a href="${url}"><strong>${album.album}</strong></a> ‚Äî Plays: ${album.totalPlays}, Peak: #${album.peak}, Weeks: ${album.weeks}, #1s: ${album.num1s}`;
        albumsList.appendChild(li);
      });

    const songsList = document.getElementById("artistSongs");
    Object.values(songsMap)
      .sort((a, b) => b.totalSales - a.totalSales)
      .forEach(song => {
        const li = document.createElement("li");
        const url = `track_detail.html?title=${encodeURIComponent(song.title)}&artist=${encodeURIComponent(song.artist)}`;
        li.innerHTML = `<a href="${url}"><strong>${song.title}</strong></a> ‚Äî Sales: ${song.totalSales}, Peak: #${song.peak}, Weeks: ${song.weeks}`;
        songsList.appendChild(li);
      });

    const chartBody = document.getElementById("chartBody");
    tableRows.forEach(row => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td>`;
      chartBody.appendChild(tr);
    });

    function sortTable(colIndex) {
      const rows = [...chartBody.querySelectorAll("tr")];
      const dir = chartBody.getAttribute("data-sort-dir") === "asc" ? "desc" : "asc";
      rows.sort((a, b) => {
        const valA = a.children[colIndex].textContent;
        const valB = b.children[colIndex].textContent;
        return dir === "asc"
          ? isNaN(valA - valB) ? valA.localeCompare(valB) : valA - valB
          : isNaN(valB - valA) ? valB.localeCompare(valA) : valB - valA;
      });
      chartBody.innerHTML = "";
      rows.forEach(row => chartBody.appendChild(row));
      chartBody.setAttribute("data-sort-dir", dir);
    }
  </script>
</body>
</html>
