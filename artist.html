<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Artist Profile</title>
  <link rel="stylesheet" href="billboard-style.css" />
  <style>
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
    .cert-icon { height: 20px; }
    .album-cert-icon { height: 32px; }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">üè† Hot 100</a>
    <a href="albums.html">üìÄ Albums</a>
    <a href="top_albums.html">üèÜ Top Albums</a>
  </nav>

  <h1 id="artistNameTitle">Artist Profile</h1>

  <section>
    <h2>üìä Artist Stats</h2>
    <p><strong>Total Songs Charted:</strong> <span id="songCount"></span></p>
    <p><strong>Number Ones:</strong> <span id="numOnes"></span></p>
    <p><strong>Top 10 Hits:</strong> <span id="top10s"></span></p>
    <p><strong>Debuts:</strong> <span id="debuts"></span></p>
    <p><strong>Total Albums Charted:</strong> <span id="albumCount"></span></p>
  </section>

  <section>
    <h2>üíø Albums</h2>
    <table id="albumsTable">
      <thead><tr><th>Album</th><th>Certification</th><th>Plays</th><th>Peak</th><th>Weeks</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h2>üé∂ Songs</h2>
    <table id="songsTable">
      <thead><tr><th>Title</th><th>Certification</th><th>Weeks</th><th>Peak</th><th>#1s</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h2>üèÖ Certification Summary</h2>
    <ul id="certSummary"></ul>
  </section>

  <script src="albumdata.js"></script>
  <script src="weekdata.js"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const artistName = params.get("artist");
    const normArtist = normalize(artistName);
    document.getElementById("artistNameTitle").textContent = artistName;

    function normalize(str) {
      return str.toUpperCase().replace(/[^A-Z0-9 ]/g, "").trim();
    }

    const albumsMap = {};
    const songsMap = {};
    const certCount = {};
    let num1s = 0, debuts = 0, songCount = 0, top10s = 0;

    function getCertIcon(count) {
      if (count < 50) return "";
      const certs = Math.floor(count / 100);
      const isGold = count >= 50 && count < 100;
      const img = isGold ? '<img src="gold.png" class="cert-icon">' : '<img src="platinum.png" class="cert-icon">';
      return isGold ? img : img.repeat(certs);
    }

    function getCertLabel(count) {
      if (count < 50) return "";
      if (count >= 50 && count < 100) return "Gold";
      return `${Math.floor(count / 100)}x Platinum`;
    }

    albumData.forEach(row => {
      if (normalize(row.artist) === normArtist) {
        const key = normalize(row.album);
        albumsMap[key] = {
          album: row.album,
          artist: row.artist,
          totalPlays: row.totalPlays,
          weeks: row.totalWeeks,
          peak: row.rank,
          certLabel: getCertLabel(row.totalPlays),
          certIcon: getCertIcon(row.totalPlays)
        };
      }
    });

    for (const week in weekData) {
      weekData[week].forEach(row => {
        const normRowArtist = normalize(row.artist);
        if (!row.title || !row.rank) return;
        if (!normRowArtist.includes(normArtist) && !normalize(row.title + " " + row.artist).includes(normArtist)) return;

        const key = normalize(row.title);
        if (!songsMap[key]) {
          songsMap[key] = {
            title: row.title,
            artist: row.artist,
            totalSales: 0,
            peak: row.rank,
            weeks: 0,
            num1s: 0
          };
        }
        songsMap[key].totalSales += row.sales || 0;
        songsMap[key].weeks++;
        if (row.rank < songsMap[key].peak) songsMap[key].peak = row.rank;
        if (row.rank === 1) songsMap[key].num1s++;
      });
    }

    const songsTable = document.querySelector("#songsTable tbody");
    const albumsTable = document.querySelector("#albumsTable tbody");

    Object.values(songsMap).forEach(song => {
      songCount++;
      if (song.weeks === 1) debuts++;
      if (song.peak <= 10) top10s++;
      if (song.num1s > 0) num1s++;

      const cert = getCertIcon(song.totalSales);
      const url = `track_detail.html?title=${encodeURIComponent(song.title)}&artist=${encodeURIComponent(song.artist)}`;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><a href="${url}">${song.title}</a></td>
        <td>${cert}</td>
        <td>${song.weeks}</td>
        <td>#${song.peak}</td>
        <td>${song.num1s}</td>`;
      songsTable.appendChild(tr);

      const label = getCertLabel(song.totalSales);
      if (label) certCount[label] = (certCount[label] || 0) + 1;
    });

    Object.values(albumsMap).forEach(album => {
      const url = `album_detail.html?album=${encodeURIComponent(album.album)}&artist=${encodeURIComponent(album.artist)}`;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><a href="${url}"><strong>${album.album}</strong></a></td>
        <td>${album.certIcon} ${album.certLabel}</td>
        <td>${album.totalPlays}</td>
        <td>#${album.peak}</td>
        <td>${album.weeks}</td>`;
      albumsTable.appendChild(tr);
    });

    document.getElementById("songCount").textContent = songCount;
    document.getElementById("debuts").textContent = debuts;
    document.getElementById("numOnes").textContent = num1s;
    document.getElementById("top10s").textContent = top10s;
    document.getElementById("albumCount").textContent = Object.keys(albumsMap).length;

    const certSummary = document.getElementById("certSummary");
    Object.entries(certCount).sort().forEach(([label, count]) => {
      const li = document.createElement("li");
      li.textContent = `${label}: ${count}`;
      certSummary.appendChild(li);
    });
  </script>
</body>
</html>
