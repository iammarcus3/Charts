<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Album Detail</title>
  <style>
    body {
      font-family: 'Arial Black', sans-serif;
      background-color: #000;
      color: #fff;
      margin: 0;
      padding: 2rem;
    }

    a {
      color: #00f0ff;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    h1 {
      font-size: 2rem;
      color: #ff007f;
      margin-bottom: 0.3rem;
    }

    h2 {
      color: #00f0ff;
      margin-top: 2rem;
      border-bottom: 2px solid #ff007f;
      padding-bottom: 0.3rem;
    }

    p {
      margin: 0.4rem 0;
      font-size: 1rem;
    }

    .cert {
      font-weight: bold;
      font-size: 1.1rem;
      margin-top: 1rem;
      color: #ffcc00;
    }

    .error {
      color: red;
      font-weight: bold;
      margin-top: 1rem;
    }

    ul {
      padding-left: 1.5rem;
    }

    li {
      margin-bottom: 0.4rem;
      font-size: 1rem;
    }

    nav {
      background-color: #111;
      padding: 1rem;
      margin-bottom: 2rem;
      border-radius: 8px;
      text-align: center;
    }

    nav a {
      margin: 0 1rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">üè† Hot 100</a>
    <a href="albums.html">üìÄ Albums</a>
    <a href="top_albums.html">üèÜ Top Albums</a>
    <a href="records.html">üìä Records</a>
  </nav>

  <h1><a id="albumLink" href="#">Album Detail</a></h1>
  <p><strong>Artist:</strong> <a id="artistLink" href="#">Artist</a></p>
  <p><strong>Total Plays:</strong> <span id="totalSales">0</span></p>
  <p><strong>Total Weeks:</strong> <span id="totalWeeks">0</span></p>
  <p><strong>Peak Rank:</strong> <span id="peak">-</span></p>
  <p><strong>Debut Week:</strong> <span id="debutWeek">-</span></p>
  <p class="cert"><strong>Certification:</strong> <span id="certification">‚Äî</span></p>

  <h2>Tracks</h2>
  <ul id="trackList"></ul>
  <p id="error" class="error"></p>

  <script src="weekdata.js"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const albumParam = params.get("album");
    const artistParam = params.get("artist");

    const normalize = str =>
      typeof str === "string" ? str.toUpperCase().replace(/[^A-Z0-9]/g, "").trim() : "";

    const normalizeAlbum = str =>
      typeof str === "string"
        ? str
            .toUpperCase()
            .replace(/\(.*?\)|\[.*?\]/g, "")
            .replace(/DELUXE|BONUS|VERSION|REMIX|EP|REMASTERED|EXPANDED/gi, "")
            .replace(/[^A-Z0-9]/g, "")
            .trim()
        : "";

    const normalizeTitle = str =>
      typeof str === "string"
        ? str
            .toUpperCase()
            .replace(/\(.*?\)|\[.*?\]|REMIX|RADIO EDIT|FEAT\.?|FEATURING|VERSION|SINGLE/gi, "")
            .replace(/[^A-Z0-9]/g, "")
            .trim()
        : "";

    function getCertification(sales) {
      if (sales >= 1000) return "üíø Multi-Platinum (x" + Math.floor(sales / 500) + ")";
      if (sales >= 500) return "üíø Platinum";
      if (sales >= 250) return "ü•á Gold";
      return "‚Äî";
    }

    const albumLink = document.getElementById("albumLink");
    const artistLink = document.getElementById("artistLink");
    const totalSalesEl = document.getElementById("totalSales");
    const totalWeeksEl = document.getElementById("totalWeeks");
    const peakEl = document.getElementById("peak");
    const debutEl = document.getElementById("debutWeek");
    const certEl = document.getElementById("certification");
    const trackList = document.getElementById("trackList");
    const errorEl = document.getElementById("error");

    albumLink.textContent = albumParam;
    artistLink.textContent = artistParam;
    albumLink.href = `album_detail.html?album=${encodeURIComponent(albumParam)}&artist=${encodeURIComponent(artistParam)}`;
    artistLink.href = `artist.html?artist=${encodeURIComponent(artistParam)}`;

    const normArtist = normalize(artistParam);
    const normAlbum = normalizeAlbum(albumParam);

    let totalSales = 0;
    const weekSet = new Set();
    let debutWeek = null;
    let peak = Infinity;
    const tracks = {};

    for (const week in weekData) {
      const weekNum = parseInt(week.replace(/\D/g, ""));
      weekData[week].forEach(entry => {
        const entryArtist = normalize(entry.artist);
        const entryAlbum = normalizeAlbum(entry.album);
        const entryTitle = entry.title;
        const entrySales = parseFloat(entry.sales) || 0;

        if (entryArtist === normArtist && entryAlbum === normAlbum) {
          totalSales += entrySales;
          weekSet.add(week);
          if (!debutWeek || weekNum < debutWeek) debutWeek = weekNum;
          if (entry.rank && entry.rank < peak) peak = entry.rank;

          const trackKey = normalizeTitle(entryTitle);
          if (!tracks[trackKey]) {
            tracks[trackKey] = { title: entryTitle, sales: 0 };
          }
          tracks[trackKey].sales += entrySales;
        }
      });
    }

    totalSalesEl.textContent = Math.round(totalSales);
    totalWeeksEl.textContent = weekSet.size;
    debutEl.textContent = debutWeek || "-";
    peakEl.textContent = peak === Infinity ? "-" : `#${peak}`;
    certEl.textContent = getCertification(totalSales);

    const sortedTracks = Object.values(tracks).sort((a, b) => b.sales - a.sales);
    if (sortedTracks.length === 0) {
      errorEl.textContent = "‚ö†Ô∏è No matching album data found in weekdata.js.";
    } else {
      sortedTracks.forEach(track => {
        const li = document.createElement("li");
        li.textContent = `${track.title} (${Math.round(track.sales)} plays)`;
        trackList.appendChild(li);
      });
    }
  </script>
</body>
</html>
