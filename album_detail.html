<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Album Details</title>
  <link rel="stylesheet" href="billboard-style.css" />
</head>
<body>
  <nav>
    <a href="top_albums.html">‚¨ÖÔ∏è Back to Top Albums</a>
    <a href="index.html">üè† Billboard Hot 100</a>
    <a href="albums.html">üìÄ Album Chart</a>
  </nav>

  <h1 id="albumTitle">Album Details</h1>
  <p><strong>Artist:</strong> <span id="artistName"></span></p>
  <p><strong>Total Weeks on Chart:</strong> <span id="weeksTotal"></span></p>
  <p><strong>Weeks at #1:</strong> <span id="weeksNo1"></span></p>
  <p><strong>Weeks in Top 10:</strong> <span id="weeksTop10"></span></p>
  <p><strong>Highest Peak:</strong> <span id="highestPeak"></span></p>
  <p><strong>Largest Single Week Plays:</strong> <span id="largestPlays"></span></p>
  <p><strong>Debut Peak:</strong> <span id="debutPeak"></span></p>
  <p><strong>Total Sales:</strong> <span id="salesTotal"></span></p>

  <h2>Tracks and Certifications (from Hot 100)</h2>
  <ul id="trackList"></ul>

  <script src="albumdata.js"></script>
  <script src="weekdata.js"></script>
  <script>
    function normalize(str) {
      return str.toUpperCase()
        .replace(/\(.*?\)|\[.*?\]|DELUXE|REMIX|BONUS|EP|VERSION/gi, "")
        .replace(/[^A-Z0-9 ]/g, "")
        .trim();
    }

    const params = new URLSearchParams(location.search);
    const albumName = params.get("album");
    const artistName = params.get("artist");

    document.getElementById('albumTitle').textContent = albumName;
    document.getElementById('artistName').textContent = artistName;

    const albumKey = normalize(artistName) + "|" + normalize(albumName);
    let totalWeeks = 0, top10 = 0, no1 = 0, peak = 999, maxPlays = 0, sales = 0, debut = null;
    const trackSales = {};
    const allTrackNames = new Set();

    // 1. Build list of tracks from albumdata.js
    for (const week in albumData) {
      const weekNum = parseInt(week.replace(/\D/g, ""));
      albumData[week].forEach(row => {
        const key = normalize(row.artist) + "|" + normalize(row.album);
        if (key === albumKey) {
          if (row.tracks) {
            row.tracks.forEach(track => allTrackNames.add(normalize(track)));
          }
          totalWeeks++;
          if (row.rank === 1) no1++;
          if (row.rank <= 10) top10++;
          if (row.rank < peak) peak = row.rank;
          if (row.plays > maxPlays) maxPlays = row.plays;
          sales += row.plays;
          if (debut === null || weekNum < debut.week) {
            debut = { week: weekNum, peak: row.rank };
          }
        }
      });
    }

    // 2. Search weekdata.js to find track sales by title
    for (const week in weekData) {
      weekData[week].forEach(row => {
        const songKey = normalize(row.title);
        const artistKey = normalize(row.artist);
        if (artistKey === normalize(artistName) && allTrackNames.has(songKey)) {
          if (!trackSales[songKey]) trackSales[songKey] = 0;
          trackSales[songKey] += row.sales || 0;
        }
      });
    }

    // 3. Display album info
    document.getElementById("weeksTotal").textContent = totalWeeks;
    document.getElementById("weeksNo1").textContent = no1;
    document.getElementById("weeksTop10").textContent = top10;
    document.getElementById("highestPeak").textContent = peak === 999 ? "-" : peak;
    document.getElementById("largestPlays").textContent = maxPlays;
    document.getElementById("debutPeak").textContent = debut ? debut.peak : "-";
    document.getElementById("salesTotal").textContent = sales;

    // 4. Show track list with certs
    function certText(sales) {
      if (sales >= 100) return "Platinum x" + Math.floor(sales / 100);
      if (sales >= 50) return "Gold";
      return "None";
    }

    function certImage(sales) {
      if (sales >= 100) return "platinum.png";
      if (sales >= 50) return "gold.png";
      return null;
    }

    const list = document.getElementById("trackList");
    for (const trackName of allTrackNames) {
      const sales = trackSales[trackName] || 0;
      const cert = certImage(sales);
      const url = `track_detail.html?title=${encodeURIComponent(trackName)}&artist=${encodeURIComponent(artistName)}`;
      const li = document.createElement("li");
      li.innerHTML = `
        <div class="cert-box">
          <a href="${url}"><strong>${trackName}</strong></a>
          ${cert ? `<img src="${cert}" alt="cert"><span>${certText(sales)}</span>` : `<span>None</span>`}
        </div>`;
      list.appendChild(li);
    }
  </script>
</body>
</html>
