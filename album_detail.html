<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Album Details</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; background: #f8f8f8; }
    nav a { margin-right: 1rem; }
    h1 { margin-bottom: 0.5rem; }
    .cert-box { margin: 0.5rem 0; }
    .cert-box img { height: 20px; vertical-align: middle; margin-left: 0.5rem; }
    ul { padding-left: 1.5rem; }
  </style>
</head>
<body>
  <nav>
    <a href="top_albums.html">‚¨ÖÔ∏è Back to Top Albums</a>
    <a href="index.html">üè† Billboard Hot 100</a>
    <a href="albums.html">üìÄ Album Chart</a>
  </nav>

  <h1 id="albumTitle">Album Details</h1>
  <p><strong>Artist:</strong> <span id="artistName"></span></p>
  <p><strong>Total Weeks on Chart:</strong> <span id="weeksTotal"></span></p>
  <p><strong>Weeks at #1:</strong> <span id="weeksNo1"></span></p>
  <p><strong>Weeks in Top 10:</strong> <span id="weeksTop10"></span></p>
  <p><strong>Highest Peak:</strong> <span id="highestPeak"></span></p>
  <p><strong>Largest Single Week Plays:</strong> <span id="largestPlays"></span></p>
  <p><strong>Debut Peak:</strong> <span id="debutPeak"></span></p>
  <p><strong>Total Sales:</strong> <span id="salesTotal"></span></p>

  <h2>Tracks from this Album</h2>
  <ul id="trackList"></ul>

  <script src="weekdata.js"></script>
  <script>
    function normalize(str) {
      return str.toUpperCase().replace(/\(.*?\)|\[.*?\]|DELUXE|REMIX|BONUS|EP|VERSION/gi, "")
        .replace(/[^A-Z0-9 ]/g, "").trim();
    }

    const params = new URLSearchParams(location.search);
    const albumName = params.get("album");
    const artistName = params.get("artist");
    const normAlbum = normalize(albumName);
    const normArtist = normalize(artistName);

    document.getElementById("albumTitle").textContent = albumName;
    document.getElementById("artistName").textContent = artistName;

    let totalWeeks = 0, weeksAt1 = 0, weeksTop10 = 0, peak = 999, debut = null, maxPlays = 0, totalSales = 0;
    const tracksMap = {};

    for (const week in weekData) {
      weekData[week].forEach(row => {
        if (!row.album || !row.artist || !row.title) return;
        if (normalize(row.album) === normAlbum && normalize(row.artist) === normArtist) {
          totalWeeks++;
          totalSales += row.sales || 0;
          if (row.rank === 1) weeksAt1++;
          if (row.rank <= 10) weeksTop10++;
          if (row.rank < peak) peak = row.rank;
          if ((row.sales || 0) > maxPlays) maxPlays = row.sales;
          const weekNum = parseInt(week.replace(/\D/g, ""));
          if (!debut || weekNum < debut.week) debut = { week: weekNum, peak: row.rank };

          const songKey = normalize(row.title);
          if (!tracksMap[songKey]) {
            tracksMap[songKey] = {
              title: row.title,
              sales: 0
            };
          }
          tracksMap[songKey].sales += row.sales || 0;
        }
      });
    }

    document.getElementById("weeksTotal").textContent = totalWeeks;
    document.getElementById("weeksNo1").textContent = weeksAt1;
    document.getElementById("weeksTop10").textContent = weeksTop10;
    document.getElementById("highestPeak").textContent = peak === 999 ? "-" : peak;
    document.getElementById("largestPlays").textContent = maxPlays;
    document.getElementById("debutPeak").textContent = debut ? debut.peak : "-";
    document.getElementById("salesTotal").textContent = totalSales;

    function certText(sales) {
      if (sales >= 100) return "Platinum x" + Math.floor(sales / 100);
      if (sales >= 50) return "Gold";
      return "None";
    }

    function certImage(sales) {
      if (sales >= 100) return "platinum.png";
      if (sales >= 50) return "gold.png";
      return null;
    }

    const list = document.getElementById("trackList");
    Object.values(tracksMap).sort((a, b) => b.sales - a.sales).forEach(track => {
      const cert = certImage(track.sales);
      const url = `track_detail.html?title=${encodeURIComponent(track.title)}&artist=${encodeURIComponent(artistName)}`;
      const li = document.createElement("li");
      li.innerHTML = `
        <div class="cert-box">
          <a href="${url}"><strong>${track.title}</strong></a>
          ${cert ? `<img src="${cert}" alt="cert"><span> ${certText(track.sales)}</span>` : `<span> None</span>`}
        </div>`;
      list.appendChild(li);
    });
  </script>
</body>
</html>
