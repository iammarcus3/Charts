<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Billboard Hot 100</title>
  <style>
    body {
      background-color: #0f0f0f;
      color: #ffffff;
      font-family: 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 2rem;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: bold;
      color: #00ffff;
      text-align: center;
      margin-bottom: 2rem;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    #weekSelector {
      padding: 0.5rem;
      font-size: 1rem;
      background-color: #1a1a1a;
      color: #00ffff;
      border: 1px solid #00ffff;
      margin-right: 1rem;
    }

    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background-color: #00ffff;
      color: #0f0f0f;
      border: none;
      cursor: pointer;
      margin-right: 0.5rem;
    }

    button:hover {
      background-color: #00cccc;
    }

    .tabs {
      display: flex;
      justify-content: center;
      margin-top: 2rem;
    }

    .tab {
      background-color: #1a1a1a;
      color: #00ffff;
      padding: 0.5rem 1rem;
      margin: 0 0.25rem;
      cursor: pointer;
      border: 1px solid #00ffff;
    }

    .tab.active {
      background-color: #00ffff;
      color: #0f0f0f;
      font-weight: bold;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    thead {
      background-color: #1a1a1a;
    }

    th, td {
      padding: 0.8rem;
      text-align: left;
      border-bottom: 1px solid #333;
      font-size: 0.95rem;
    }

    th {
      color: #00ffff;
      text-transform: uppercase;
      font-weight: 600;
    }

    tr:hover {
      background-color: #1f1f1f;
    }

    a {
      color: #ffffff;
      text-decoration: none;
      font-weight: 500;
    }

    a:hover {
      color: #00ffff;
      text-decoration: underline;
    }

    strong {
      color: #00ffff;
    }

    .move-up {
      color: #00ff00;
    }

    .move-down {
      color: #ff3333;
    }

    .move-stay {
      color: #cccccc;
    }
  </style>
  <script src="weekdata.js"></script>
</head>
<body>
  <h1>Billboard Hot 100</h1>

  <div style="text-align: center;">
    <select id="weekSelector"></select>
    <button onclick="changeWeek(-1)">‚¨ÖÔ∏è</button>
    <button onclick="changeWeek(1)">‚û°Ô∏è</button>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="switchChart('tracks')">Tracks</div>
    <div class="tab" onclick="switchChart('albums')">Albums</div>
  </div>

  <table id="chart">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Move</th>
        <th>Title</th>
        <th>Artist</th>
        <th>Sales</th>
        <th>Total Sales</th>
        <th>Weeks</th>
        <th>Peak</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    function normalize(text) {
      return (text || "").toLowerCase()
        .replace(/\(.*?\)/g, '')
        .replace(/\[.*?\]/g, '')
        .replace(/feat\..*/g, '')
        .replace(/[^a-z0-9]/g, '');
    }

    function getFuzzyKey(title, artist) {
      return normalize(title) + normalize(artist);
    }

    let currentWeek = 1;
    let currentChart = 'tracks';

    function switchChart(chartType) {
      currentChart = chartType;
      document.querySelectorAll(".tab").forEach(tab => {
        tab.classList.remove("active");
      });
      document.querySelector(`.tab:nth-child(${chartType === 'tracks' ? 1 : 2})`).classList.add("active");
      loadWeek(currentWeek);
    }

    function loadWeek(weekNumber) {
      currentWeek = weekNumber;
      const allData = weekData[weekNumber] || [];

      const chartData = allData.filter(row =>
        currentChart === 'albums' ? row.album && row.album !== 'NaN' : !row.album || row.album === 'NaN'
      );

      const tbody = document.querySelector("#chart tbody");
      tbody.innerHTML = "";

      const history = {};
      for (let i = 1; i < weekNumber; i++) {
        for (const row of weekData[i] || []) {
          const match = currentChart === 'albums' ? row.album && row.album !== 'NaN' : !row.album || row.album === 'NaN';
          if (!match) continue;
          const key = getFuzzyKey(row.title, row.artist);
          if (!history[key]) history[key] = [];
          history[key].push({ ...row, week: i });
        }
      }

      for (const row of chartData) {
        const key = getFuzzyKey(row.title, row.artist);
        const past = history[key] || [];

        const totalWeeks = past.length + 1;
        const totalSales = past.reduce((sum, r) => sum + r.sales, 0) + row.sales;
        const bestPeak = Math.min(...past.map(r => parseInt(r.rank)).concat([parseInt(row.rank)]));

        let movementIcon = "‚û°Ô∏è", movementText = "", moveClass = "move-stay";
        if (past.length === 0) {
          movementIcon = "üÜï";
        } else {
          const lastRank = parseInt(past[past.length - 1].rank);
          const currentRank = parseInt(row.rank);
          const diff = lastRank - currentRank;
          if (diff > 0) {
            movementIcon = "‚¨ÜÔ∏è";
            movementText = ` <span class="move-up">+${diff}</span>`;
            moveClass = "move-up";
          } else if (diff < 0) {
            movementIcon = "‚¨áÔ∏è";
            movementText = ` <span class="move-down">${diff}</span>`;
            moveClass = "move-down";
          }
        }

        const titleHTML = `<a href="track_detail.html?title=${encodeURIComponent(row.title)}&artist=${encodeURIComponent(row.artist)}">${movementIcon === "üÜï" ? `<strong>${row.title}</strong>` : row.title}</a>`;
        const artistHTML = `<a href="artist.html?artist=${encodeURIComponent(row.artist)}">${row.artist}</a>`;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.rank}</td>
          <td>${movementIcon}${movementText}</td>
          <td>${titleHTML}</td>
          <td>${artistHTML}</td>
          <td>${row.sales.toFixed(2)}</td>
          <td>${totalSales.toFixed(2)}</td>
          <td>${totalWeeks}</td>
          <td>${bestPeak}</td>
        `;
        tbody.appendChild(tr);
      }

      document.getElementById("weekSelector").value = weekNumber;
    }

    function populateWeekSelector() {
      const selector = document.getElementById("weekSelector");
      const weeks = Object.keys(weekData).map(Number).sort((a, b) => b - a);
      for (const w of weeks) {
        const opt = document.createElement("option");
        opt.value = w;
        opt.textContent = `Week ${w}`;
        selector.appendChild(opt);
      }
      selector.addEventListener("change", () => loadWeek(Number(selector.value)));
      loadWeek(weeks[0]);
    }

    function changeWeek(delta) {
      const weeks = Object.keys(weekData).map(Number).sort((a, b) => b - a);
      const index = weeks.indexOf(currentWeek);
      const newIndex = index + delta;
      if (newIndex >= 0 && newIndex < weeks.length) {
        loadWeek(weeks[newIndex]);
      }
    }

    populateWeekSelector();
  </script>
</body>
</html>

