<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Top 100 Albums (All Time)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fff;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      margin-bottom: 2rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 0.6rem;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background-color: #f9f9f9;
      text-transform: uppercase;
      font-size: 0.85rem;
    }
    a {
      color: #0077cc;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .cert {
      font-size: 0.85em;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>üèÜ Top 100 Albums (by Total Plays)</h1>
  <table>
    <thead>
      <tr>
        <th>Rank</th>
        <th>Album</th>
        <th>Artist</th>
        <th>Total Plays</th>
        <th>Certification</th>
      </tr>
    </thead>
    <tbody id="albumTable"></tbody>
  </table>

  <script src="weekdata.js"></script>
  <script>
    function normalizeAlbumName(name) {
      return (name || "")
        .toUpperCase()
        .replace(/\(.*?\)|\[.*?\]|DELUXE|REMIX|VERSION|BONUS|SINGLE|EP/gi, "")
        .replace(/[^A-Z0-9 ]/g, "")
        .replace(/\s+/g, " ")
        .trim();
    }

    function getCertification(plays) {
      if (plays >= 200) return "Multi-Platinum x" + Math.floor(plays / 100);
      if (plays >= 100) return "Platinum";
      if (plays >= 50) return "Gold";
      return "‚Äî";
    }

    const albumMap = {};

    if (typeof weekData !== "object") {
      alert("weekdata.js is missing or malformed.");
      throw new Error("Missing weekdata.js or weekData variable.");
    }

    // Combine album entries across all weeks
    for (const week in weekData) {
      weekData[week].forEach(row => {
        if (!row.album || !row.artist || !row.sales) return;

        const normName = normalizeAlbumName(row.album);
        const key = normName + "|" + row.artist.toUpperCase().trim();
        const sales = parseFloat(row.sales) || 0;

        if (!albumMap[key]) {
          albumMap[key] = {
            album: row.album,
            artist: row.artist,
            totalSales: 0
          };
        }

        albumMap[key].totalSales += sales;
      });
    }

    // Sort and take top 100
    const topAlbums = Object.values(albumMap)
      .filter(a => a.totalSales > 0)
      .sort((a, b) => b.totalSales - a.totalSales)
      .slice(0, 100);

    // Render to table
    const tbody = document.getElementById("albumTable");
    topAlbums.forEach((album, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i + 1}</td>
        <td><a href="album_detail.html?album=${encodeURIComponent(album.album)}&artist=${encodeURIComponent(album.artist)}">${album.album}</a></td>
        <td><a href="artist.html?name=${encodeURIComponent(album.artist)}">${album.artist}</a></td>
        <td>${album.totalSales}</td>
        <td class="cert">${getCertification(album.totalSales)}</td>
      `;
      tbody.appendChild(tr);
    });
  </script>
</body>
</html>
