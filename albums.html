<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Billboard Album Chart</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; background: #f7f7f7; }
    h1 { color: #2c3e50; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; vertical-align: middle; }
    th { background-color: #eee; }
    td img { height: 40px; display: block; }
    td .cert-text { font-size: 0.9em; margin-top: 0.2em; }
    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; }
    .modal-content { background: #fff; padding: 2rem; border-radius: 8px; width: 400px; max-height: 80vh; overflow-y: auto; }
    ul { padding-left: 1.2rem; }
  </style>
</head>
<body>
  <nav style="margin-bottom: 1.5rem;">
    <a href="index.html">üè† Main</a> |
    <a href="albums.html">üìÄ Albums Chart</a> |
    <a href="top_albums.html">üìà Top Albums</a> |
    <a href="records.html">üìä Records</a>
  </nav>

  <h1>üìÄ Billboard Album Chart</h1>

  <div>
    <select id="weekSelector"></select>
    <button onclick="navigateWeek(-1)">‚¨ÖÔ∏è</button>
    <button onclick="navigateWeek(1)">‚û°Ô∏è</button>

    <table id="albumTable">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Move</th>
          <th>Album</th>
          <th>Artist</th>
          <th>This Week</th>
          <th>Sales</th>
          <th>Weeks</th>
          <th>Peak</th>
          <th>Certification</th>
        </tr>
      </thead>
      <tbody id="chartBody"></tbody>
    </table>
  </div>

  <!-- MODAL -->
  <div class="modal" id="albumModal">
    <div class="modal-content">
      <h3 id="modalAlbum"></h3>
      <p id="modalArtist"></p>
      <p id="modalWeeks"></p>
      <p id="modalTop10"></p>
      <p id="modalNo1"></p>
      <div id="modalTracks"></div>
      <button onclick="document.getElementById('albumModal').style.display='none'">Close</button>
    </div>
  </div>

  <script src="albumdata.js"></script>
  <script>
    let sortedWeeks = [];
    let currentData = [];
    let salesTotals = {};

    function getMoveIcon(move) {
      if (!move) return "‚ûñ";
      move = move.toUpperCase();
      if (move === "UP") return "‚¨ÜÔ∏è";
      if (move === "DOWN") return "‚¨áÔ∏è";
      if (move === "NEW") return "üÜï";
      if (move.includes("RE")) return "üîÅ";
      return "‚ûñ";
    }

    function getCertImage(sales) {
      if (sales >= 100) return "platinum.png";
      if (sales >= 50) return "gold.png";
      return null;
    }

    function getCertText(sales) {
      if (sales >= 100) {
        const count = Math.floor(sales / 100);
        return count > 1 ? "Multi-Platinum x" + count : "Platinum";
      } else if (sales >= 50) {
        return "Gold";
      }
      return "None";
    }
    
    function normalize(name) {
     return name.toUpperCase()
    .replace(/\(.*?\)|\[.*?\]|DELUXE|SPECIAL|VERSION|REMIX|BONUS|EDITION|SINGLE|EP/gi, '')
    .replace(/[^A-Z0-9 ]/gi, '')
    .trim();
}
    
    function populateWeeks() {
      const selector = document.getElementById("weekSelector");
      sortedWeeks = Object.keys(albumData)
        .sort((a,b) => parseInt(b.replace(/\\D/g,'')) - parseInt(a.replace(/\\D/g,'')));
      selector.innerHTML = '';
      sortedWeeks.forEach(week => {
        const opt = document.createElement("option");
        opt.value = week;
        opt.textContent = week;
        selector.appendChild(opt);
      });
      selector.addEventListener("change", () => populateTable(selector.value));
      selector.value = sortedWeeks[sortedWeeks.length - 1];
populateTable(sortedWeeks[sortedWeeks.length - 1]);
    }

    function populateTable(currentWeek) {
      const tbody = document.getElementById("chartBody");
      tbody.innerHTML = '';
      const merged = {};
      salesTotals = {};

      const currentWeekNum = parseInt(currentWeek.replace(/\\D/g, ''));
      for (const week of sortedWeeks) {
        const weekNum = parseInt(week.replace(/\\D/g, ''));
        if (weekNum > currentWeekNum) break;

        const raw = albumData[week];
        raw.forEach(row => {
          const album = normalize(row.album);
          const key = artist + "|" + album;
          salesTotals[key] = (salesTotals[key] || 0) + row.plays;

          if (week === currentWeek) {
            if (!merged[key]) {
              merged[key] = {
                artist: artist,
                album: row.album,
                plays: row.plays,
                weeks: row.weeks,
                peak: row.rank,
                move: row.move
              };
            } else {
              merged[key].plays += row.plays;
              merged[key].weeks += row.weeks;
              merged[key].peak = Math.min(merged[key].peak, row.rank);
            }
          }
        });
      }

      const sorted = Object.entries(merged).map(([key, val]) => {
        val.sales = salesTotals[key];
        return val;
      }).sort((a, b) => b.sales - a.sales).map((row, i) => ({ ...row, rank: i + 1 }));

      currentData = sorted;

      currentData.forEach(row => {
        const certImg = getCertImage(row.sales);
        const certText = getCertText(row.sales);
        const certHTML = certImg
          ? `<img src="${certImg}" alt="${certText}"><div class="cert-text">${certText}</div>`
          : "‚Äî";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.rank}</td>
          <td>${getMoveIcon(row.move)}</td>
          <td><a href="#" onclick='showModal(${JSON.stringify(row)})'>${row.album}</a></td>
          <td>${row.artist}</td>
          <td>${row.plays}</td>
          <td>${row.sales}</td>
          <td>${row.weeks}</td>
          <td>${row.peak}</td>
          <td>${certHTML}</td>`;
        tbody.appendChild(tr);
      });
    }

    function showModal(album) {
      const key = album.artist.trim() + "|" + album.album.trim().toLowerCase();
      let weeks = 0, top10 = 0, no1 = 0;
      const trackSales = {};

      for (const week of sortedWeeks) {
        const raw = albumData[week];
        raw.forEach(row => {
          const rowKey = row.artist.trim() + "|" + row.album.trim().toLowerCase();
          if (rowKey === key) {
            weeks++;
            if (row.rank === 1) no1++;
            if (row.rank <= 10) top10++;
            if (row.title) {
              const title = row.title.trim();
              if (!trackSales[title]) trackSales[title] = 0;
              trackSales[title] += row.sales || row.plays || 0;
            }
          }
        });
      }

      const trackList = Object.keys(trackSales).sort().map(song =>
        `<li>‚Ä¢ ${song} ‚Äî ${getCertText(trackSales[song])}</li>`
      ).join("");

      document.getElementById("modalAlbum").textContent = album.album;
      document.getElementById("modalArtist").textContent = "Artist: " + album.artist;
      document.getElementById("modalWeeks").textContent = "Total Weeks on Chart: " + weeks;
      document.getElementById("modalTop10").textContent = "Top 10 Weeks: " + top10;
      document.getElementById("modalNo1").textContent = "#1 Weeks: " + no1;
      document.getElementById("modalTracks").innerHTML = "<p><b>Tracks:</b></p><ul>" + trackList + "</ul>";
      document.getElementById("albumModal").style.display = "flex";
    }

    function navigateWeek(dir) {
      const selector = document.getElementById("weekSelector");
      const idx = sortedWeeks.indexOf(selector.value);
      const newIdx = idx + dir;
      if (newIdx >= 0 && newIdx < sortedWeeks.length) {
        selector.value = sortedWeeks[newIdx];
        populateTable(sortedWeeks[newIdx]);
      }
    }

    document.addEventListener("DOMContentLoaded", populateWeeks);
  </script>
</body>
</html>
